<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BlackJack</title>
</head>
<style>

    .panel{
        box-sizing: border-box;
        border: 3px solid black;
        display: flex;
        height:600px;
        postion:relative;
    }
    .left-panel{
        width:20%;
        background: darkgray;
    }
    .right-panel{
        width: 80%;
        background-color:darkgreen;
    }
    button{
        height:20px;
    }
    img{
        max-width: 15%;
        height: auto;
        display:inline-block;
    }
    .container{
        position:relative;
    }
    h1.winlose{
        position: absolute;
        top:30%;
        left:20%;
        font-size: 100px;
        visibility: hidden;
    }
</style>
<body>
<div class="container">
<div class="panel">
    <div class="left-panel">
        <div>
            <button id="deal" onclick="deal()">
                Deal
            </button>
        </div>
        <div>
            <button id="hit" onclick="hit()" disabled>
                Hit
            </button>
        </div>
        <div>
            <button id="stand" onclick="stand()" disabled>
                Stand
            </button>
        </div>
        <div>
            <button id="exit" onclick="exit()">
                Exit
            </button>
        </div>
    </div>
    <div class="right-panel">
        <div>
            <p>Dealer's hand is:</p>
            <div id="dealer-hand">
                <img id="dealer-1" src="card_pngs/card-back.png">
                <img id="dealer-2" src="card_pngs/card-back.png">
            </div>
        </div>
        <div>
            <p>Your hand is:</p>
            <div id="player-hand">
                <img id="player-1" src="card_pngs/black_joker.png">
                <img id="player-2" src="card_pngs/red_joker.png">
            </div>
        </div>
    </div>
</div>
<h1 class="winlose" id="win">Winner</h1>
<h1 class="winlose" id="lose">Loser</h1>
</div>
</body>
<script>
    let cards = [];
    /*populate cards*/
    for(let i=0;i<4;i++){
        let suit ="";
        switch (i){
            case 0:
                suit="clubs";
                break;
            case 1:
                suit="diamonds";
                break;
            case 2:
                suit="hearts";
                break;
            case 3:
                suit="spades";
                break;
            default:
            /*figure out how to throw error*/
        }
        cards.push("card_pngs/"+"ace_of_"+suit+".png");
        for(let j=0;j<9;j++){
            cards.push("card_pngs/"+(j+2)+"_of_"+suit+".png");
        }
        cards.push("card_pngs/"+"jack_of_"+suit+".png");
        cards.push("card_pngs/"+"queen_of_"+suit+".png");
        cards.push("card_pngs/"+"king_of_"+suit+".png");
    }

    let cards_used = []
    let player_total = 0;
    let dealer_total = 0;
    let player_aces = 0;
    let dealer_aces = 0;

    reset();
    function deal(){
        document.getElementById("win").style.visibility="hidden";
        document.getElementById("lose").style.visibility="hidden";

        // console.log(document.getElementById("player-hand").children);
        {
            let p=document.getElementById("player-hand");
            while(p.lastElementChild){
                p.removeChild(p.lastElementChild);
            }
            p=document.getElementById("dealer-hand");
            while(p.lastElementChild){
                p.removeChild(p.lastElementChild);
            }
        }

        cards_used=[];
        player_total = 0;
        dealer_total = 0;
        player_aces = 0;
        dealer_aces = 0;

        dealCardPlayer();
        dealCardPlayer();
        dealCardDealer();
        dealSecret();


        document.getElementById("hit").disabled = false;
        document.getElementById("stand").disabled = false;
        document.getElementById("deal").disabled = true;
    }
    function dealSecret(){
        const image = document.createElement('img');
        image.id="secret";
        image.src="card_pngs/card-back.png";
        image.alt="card_back";
        document.getElementById("dealer-hand").appendChild(image);
    }

    function dealCard(p){
        const image = document.createElement('img');
        let r;
        do{
            r=Math.floor(Math.random()*52);
        }while(contains(cards_used, r))
        cards_used.push(r);
        image.src=cards[r];
        image.alt=cards[r];
        p.appendChild(image);
        return Math.min((r%13)+1, 10);
    }


    function dealCardPlayer(){
        let n = dealCard(document.getElementById("player-hand"));
        player_total += n;
        // const image = document.createElement('img');
        // let r;
        // do{
        //     r=Math.floor(Math.random()*52);
        // }while(contains(cards_used, r))
        // cards_used.push(r);
        // image.src=cards[r];
        // image.alt=cards[r];
        // document.getElementById("player-hand").appendChild(image);
        // player_total += Math.min((r%13)+1, 10);
    }
    function contains(arr, e){
        for(let i = 0; i < arr.length; i++){
            if(arr[i]==e){
                return true;
            }
        }
        return false;
    }
    function dealCardDealer(){
        const image = document.createElement('img');
        let r;
        do{
            r=Math.floor(Math.random()*52);
        }while(contains(cards_used, r))
        cards_used.push(r);
        image.src=cards[r];
        image.alt=cards[r];
        document.getElementById("dealer-hand").appendChild(image);
        dealer_total += Math.min((r%13)+1, 10);
    }


    function hit(){
        dealCardPlayer();
        if(player_total>21)
            document.getElementById("hit").disabled = true;
    }
    function stand(){
        document.getElementById("secret").remove();
        do{
            dealCardDealer();
        }while(dealer_total<17)
        if(player_total>21){
            lose();
            return;
        }
        if(dealer_total>21||player_total>dealer_total){
            win();
            return;
        }
        lose();
    }
    function lose(){
        document.getElementById("lose").style.visibility="visible";
        reset();
    }
    function win(){
        document.getElementById("win").style.visibility="visible";
        reset();
    }
    function reset(){
        document.getElementById("hit").disabled = true;
        document.getElementById("stand").disabled = true;
        document.getElementById("deal").disabled = false;
    }
    function exit(){
        window.close();
    }
</script>
</html>